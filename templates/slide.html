<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{chapterTitle}} - Slide {{slideNumber}}</title>
    <link rel="stylesheet" href="../../../assets/css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Prism.js for syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-typescript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-jsx.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-tsx.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
</head>
<body class="slide-page">
    {{navBar}}

    <div class="slide-viewport">
        <div class="slide">
            <!-- Pannello sinistro -->
            <div class="nav-panel left {{prevSlideClass}}" id="prevPanel">
            </div>

            <!-- Contenuto centrale -->
            <div class="slide-content">
                {{content}}
                <div class="slide-number">{{slideNumber}} / {{totalSlides}}</div>
            </div>

            <!-- Pannello destro -->
            <div class="nav-panel right {{nextSlideClass}}" id="nextPanel">
            </div>
        </div>
    </div>

    <script>
        const hasPrev = '{{prevSlide}}' !== '';
        const hasNext = '{{nextSlide}}' !== '';
        const prevSlide = '{{prevSlide}}';
        const nextSlide = '{{nextSlide}}';
        const indexLink = '{{indexLink}}';

        // Language selector
        function toggleLangMenu(event) {
            event.stopPropagation();
            const menu = document.getElementById('langMenu');
            menu.classList.toggle('show');
        }

        function switchLanguage(targetLang, event) {
            event.preventDefault();
            const currentPath = window.location.pathname;
            const pathParts = currentPath.split('/');

            // Trova l'indice di "output" nel path
            const outputIndex = pathParts.indexOf('output');
            if (outputIndex === -1) return;

            const currentLang = pathParts[outputIndex + 1]; // it o en

            if (currentLang === targetLang) {
                document.getElementById('langMenu').classList.remove('show');
                return;
            }

            // Salva preferenza
            localStorage.setItem('course-lang', targetLang);

            // Costruisci il nuovo path sostituendo la lingua
            pathParts[outputIndex + 1] = targetLang;
            const newPath = pathParts.join('/');

            // Prova a caricare la pagina nella nuova lingua
            fetch(newPath, { method: 'HEAD' })
                .then(response => {
                    if (response.ok) {
                        // Pagina esiste, redirige
                        window.location.pathname = newPath;
                    } else {
                        // Pagina non esiste, prova la lingua opposta
                        const oppositeLang = currentLang; // La lingua originale
                        pathParts[outputIndex + 1] = oppositeLang;
                        const fallbackPath = pathParts.join('/');

                        return fetch(fallbackPath, { method: 'HEAD' })
                            .then(fallbackResponse => {
                                if (fallbackResponse.ok) {
                                    // Pagina esiste nella lingua opposta
                                    window.location.pathname = fallbackPath;
                                } else {
                                    // Nessuna versione esiste, vai all'index della lingua target
                                    pathParts[outputIndex + 1] = targetLang;
                                    const indexPath = pathParts.slice(0, outputIndex + 2).join('/') + '/index.html';
                                    window.location.pathname = indexPath;
                                }
                            });
                    }
                })
                .catch(() => {
                    // Errore, fallback all'index della lingua target
                    pathParts[outputIndex + 1] = targetLang;
                    const indexPath = pathParts.slice(0, outputIndex + 2).join('/') + '/index.html';
                    window.location.pathname = indexPath;
                });
        }

        // Chiudi menu quando clicchi fuori
        document.addEventListener('click', () => {
            const menu = document.getElementById('langMenu');
            if (menu) menu.classList.remove('show');
        });

        // Navigazione con click sui pannelli
        document.getElementById('prevPanel').addEventListener('click', () => {
            if (hasPrev) {
                window.location.href = prevSlide;
            }
        });

        document.getElementById('nextPanel').addEventListener('click', () => {
            if (hasNext) {
                window.location.href = nextSlide;
            }
        });

        // Navigazione con tastiera
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft' && hasPrev) {
                window.location.href = prevSlide;
            } else if ((e.key === 'ArrowRight' || e.key === ' ') && hasNext) {
                e.preventDefault();
                window.location.href = nextSlide;
            } else if (e.key === 'Escape' || e.key === 'h' || e.key === 'H') {
                window.location.href = indexLink;
            }
        });

        // Touch/swipe support per mobile
        let touchStartX = 0;
        let touchEndX = 0;

        document.addEventListener('touchstart', (e) => {
            touchStartX = e.changedTouches[0].screenX;
        });

        document.addEventListener('touchend', (e) => {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        });

        function handleSwipe() {
            if (touchEndX < touchStartX - 50 && hasNext) {
                // Swipe left - next slide
                window.location.href = nextSlide;
            }
            if (touchEndX > touchStartX + 50 && hasPrev) {
                // Swipe right - previous slide
                window.location.href = prevSlide;
            }
        }

        // Copy code functionality
        function copyCode(button) {
            const wrapper = button.closest('.code-block-wrapper');
            const code = wrapper.querySelector('code').textContent;

            navigator.clipboard.writeText(code).then(() => {
                const originalText = button.innerHTML;
                button.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg> Copiato!';
                button.classList.add('copied');

                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.classList.remove('copied');
                }, 2000);
            });
        }
    </script>

    <!-- Common Fixed Footer -->
    <footer class="common-footer">
        <p>&copy; 2025 Lorenzo Bazzani</p>
        <span class="footer-separator">|</span>
        <p>Cloud Infrastructure & Generative AI Consultant</p>
        <span class="footer-separator">|</span>
        <div class="footer-links">
            <a href="https://it.linkedin.com/in/lorenzo-bazzani" target="_blank" rel="noopener noreferrer">LinkedIn</a>
            <a href="https://bazzani.info" target="_blank" rel="noopener noreferrer">Website</a>
            <a href="mailto:lorenzo@bazzani.info">Email</a>
        </div>
    </footer>
</body>
</html>
